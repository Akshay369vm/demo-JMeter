on: [push]
jobs:
  jmeter_job:
    runs-on: ubuntu-latest
    name: JMeter Test Execution
    steps:      
      - name: Checkout
        uses: actions/checkout@v2
        
      - name: Run JMeter Tests
        uses: QAInsights/PerfAction@v3.1
        with:
          test-plan-path: jmeter.jmx
          args: ""
          
      - name: Upload Results
        uses: actions/upload-artifact@v2
        with:
          name: jmeter-results
          path: result.jtl
      - name: Send mail
        uses: dawidd6/action-send-mail@v3
        with:
         # Specify connection via URL (replaces server_address, server_port, secure,
         # username and password)
         #
         # Format:
         #
         #  * smtp://user:password@server:port
         #  * smtp+starttls://user:password@server:port
         #connection_url: ${{secrets.MAIL_CONNECTION}}
         # Required mail server address if not connection_url:
         server_address: smtp.gmail.com
         # Server port, default 25:
         server_port: 465
         # Optional whether this connection use TLS (default is true if server_port is 465)
         secure: true
         # Optional (recommended): mail server username:
         username: ${{secrets.MAIL_USERNAME}}
         # Optional (recommended) mail server password:
         password: ${{secrets.MAIL_PASSWORD}}
         # Required mail subject:
         subject:  ${{ github.job }} job of ${{ github.repository }} has ${{ job.status }}
         # Required recipients' addresses:
         to: akshayvm97@gmail.com
         # Required sender full name (address can be skipped):
         from: Anjana R # <user@example.com>
         # Optional plain body:
         body: ${{ github.job }} job in worflow ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }}2
         priority: low
